import{j as e,ah as s,ac as a,ai as r,aj as t,ak as i,m as l,E as n,D as c,ad as o,a2 as d,al as m,p as x,am as h}from"./ui-CW4SeC5O.js";import{r as p}from"./vendor-fM8kc8IR.js";import{u}from"./useQuery-FleDKwgl.js";import{d as j,u as v,B as g,I as f}from"./index-C9MSdL1c.js";import{u as y}from"./useMutation-CLlNb6S2.js";import{D as N}from"./DashboardLayout-CZopp9XZ.js";import{C as b}from"./Card-BAQzvENO.js";import{M as w}from"./Modal-BXTy6PvI.js";import{n as C,o as S,p as A,g as E}from"./api-Cz4wYYaF.js";import{f as k}from"./helpers-B5lfqhnz.js";import"./constants-CTD2yw_V.js";const z=()=>{var z,L;const[M,F]=p.useState(),[I,q]=p.useState([]),[B,D]=p.useState(!1),[K,Q]=p.useState(!1),[R,T]=p.useState(""),[U,O]=p.useState(""),P=j(),V=v(),{data:$,isLoading:G}=u({queryKey:["files",M],queryFn:()=>E(M)}),H=y({mutationFn:S,onSuccess:()=>{V.success("Archivo subido correctamente"),P.invalidateQueries({queryKey:["files"]}),D(!1)},onError:()=>{V.error("Error al subir archivo")}}),_=y({mutationFn:C,onSuccess:()=>{V.success("Archivo eliminado"),P.invalidateQueries({queryKey:["files"]})},onError:()=>{V.error("Error al eliminar archivo")}}),J=y({mutationFn:A,onSuccess:()=>{V.success("Carpeta creada correctamente"),P.invalidateQueries({queryKey:["files"]}),Q(!1),T("")},onError:()=>{V.error("Error al crear carpeta")}}),W=e=>{if(!e)return"";const s=Math.floor(Math.log(e)/Math.log(1024));return`${(e/Math.pow(1024,s)).toFixed(2)} ${["Bytes","KB","MB","GB"][s]}`},X=(null==(z=null==$?void 0:$.data)?void 0:z.files)||[],Y=((null==(L=null==$?void 0:$.data)?void 0:L.folders)||[]).map(e=>({...e,mimeType:"application/vnd.google-apps.folder"})),Z=X,ee=[...Y,...Z],se=Y.filter(e=>e.name.toLowerCase().includes(U.toLowerCase())),ae=Z.filter(e=>e.name.toLowerCase().includes(U.toLowerCase()));return e.jsxs(N,{title:"Archivos",children:[e.jsx(b,{className:"mb-6",children:e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[I.length>0&&e.jsx(g,{variant:"ghost",size:"sm",leftIcon:e.jsx(s,{className:"w-4 h-4"}),onClick:()=>{const e=[...I];e.pop(),q(e),F(e.length>0?e[e.length-1].id:void 0)},children:"Volver"}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-secondary-600",children:[e.jsx("span",{className:"font-medium",children:"Raíz"}),I.map((s,a)=>e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{children:"/"}),e.jsx("span",{className:a===I.length-1?"font-medium text-primary-600":"",children:s.name})]},s.id))]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(f,{placeholder:"Buscar archivos...",value:U,onChange:e=>O(e.target.value),leftIcon:e.jsx(a,{className:"w-5 h-5"}),className:"w-48"}),e.jsx(g,{variant:"outline",size:"sm",leftIcon:e.jsx(r,{className:"w-4 h-4"}),onClick:()=>Q(!0),children:"Nueva Carpeta"}),e.jsx(g,{variant:"primary",size:"sm",leftIcon:e.jsx(t,{className:"w-4 h-4"}),onClick:()=>D(!0),children:"Subir Archivo"})]})]})}),G?e.jsx("div",{className:"text-center py-12 text-secondary-500",children:"Cargando archivos..."}):0===ee.length?e.jsxs(b,{className:"text-center py-12",children:[e.jsx(i,{className:"w-16 h-16 mx-auto text-secondary-300 mb-4"}),e.jsx("p",{className:"text-secondary-500",children:"Esta carpeta está vacía"}),e.jsx("p",{className:"text-sm text-secondary-400 mt-2",children:"Sube archivos o crea carpetas para comenzar"})]}):e.jsxs("div",{className:"space-y-6",children:[se.length>0&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold text-secondary-700 mb-3",children:"Carpetas"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4",children:se.map(s=>e.jsx(l.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},whileHover:{scale:1.02},children:e.jsxs(b,{className:"cursor-pointer hover:shadow-md transition-shadow text-center",padding:"sm",onClick:()=>(e=>{q([...I,{id:e.id,name:e.name}]),F(e.id)})(s),children:[e.jsx(i,{className:"w-12 h-12 text-amber-500 mx-auto mb-2"}),e.jsx("p",{className:"text-sm font-medium text-secondary-900 truncate",children:s.name})]})},s.id))})]}),ae.length>0&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold text-secondary-700 mb-3",children:"Archivos"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:ae.map(s=>{return e.jsx(l.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:e.jsxs(b,{className:"hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"flex-shrink-0",children:s.thumbnail?e.jsx("img",{src:s.thumbnail,alt:s.name,className:"w-16 h-16 object-cover rounded-lg"}):(a=s.mimeType,a.includes("folder")?e.jsx(i,{className:"w-10 h-10 text-amber-500"}):a.includes("image")?e.jsx(d,{className:"w-10 h-10 text-blue-500"}):a.includes("video")?e.jsx(m,{className:"w-10 h-10 text-purple-500"}):a.includes("pdf")?e.jsx(x,{className:"w-10 h-10 text-red-500"}):e.jsx(h,{className:"w-10 h-10 text-secondary-500"}))}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-secondary-900 truncate",children:s.name}),e.jsx("p",{className:"text-sm text-secondary-500",children:W(s.size)}),s.updatedAt&&e.jsx("p",{className:"text-xs text-secondary-400 mt-1",children:k(s.updatedAt)})]})]}),e.jsxs("div",{className:"flex items-center justify-end gap-2 mt-4 pt-4 border-t",children:[s.url&&e.jsx("a",{href:s.url,target:"_blank",rel:"noopener noreferrer",className:"p-2 text-secondary-600 hover:text-primary-600 hover:bg-primary-50 rounded-lg transition-colors",title:"Ver",children:e.jsx(n,{className:"w-4 h-4"})}),s.downloadUrl&&e.jsx("a",{href:s.downloadUrl,download:!0,className:"p-2 text-secondary-600 hover:text-green-600 hover:bg-green-50 rounded-lg transition-colors",title:"Descargar",children:e.jsx(c,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>_.mutate(s.id),className:"p-2 text-red-600 hover:bg-red-50 rounded-lg transition-colors",title:"Eliminar",children:e.jsx(o,{className:"w-4 h-4"})})]})]})},s.id);var a})})]})]}),e.jsx(w,{isOpen:B,onClose:()=>D(!1),title:"Subir Archivo",children:e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"border-2 border-dashed border-secondary-300 rounded-lg p-8 text-center",children:[e.jsx(t,{className:"w-12 h-12 text-secondary-400 mx-auto mb-4"}),e.jsx("p",{className:"text-secondary-600 mb-2",children:"Arrastra un archivo aquí o haz clic para seleccionar"}),e.jsx("input",{type:"file",onChange:async e=>{var s;const a=null==(s=e.target.files)?void 0:s[0];if(!a)return;const r=new FileReader;r.onload=()=>{const e=r.result.split(",")[1];H.mutate({name:a.name,content:e,mimeType:a.type,folderId:M})},r.readAsDataURL(a)},className:"hidden",id:"file-upload"}),e.jsx("label",{htmlFor:"file-upload",className:"cursor-pointer",children:e.jsx("span",{className:"inline-flex items-center justify-center px-4 py-2 bg-primary-600 text-white font-medium rounded-lg hover:bg-primary-700 transition-colors",children:H.isPending?"Subiendo...":"Seleccionar Archivo"})})]})})}),e.jsx(w,{isOpen:K,onClose:()=>Q(!1),title:"Nueva Carpeta",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx(f,{label:"Nombre de la carpeta",placeholder:"Ej: Documentos de campaña",value:R,onChange:e=>T(e.target.value)}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx(g,{variant:"ghost",onClick:()=>Q(!1),children:"Cancelar"}),e.jsx(g,{variant:"primary",onClick:()=>{R.trim()&&J.mutate({name:R,parentId:M})},isLoading:J.isPending,disabled:!R.trim(),children:"Crear Carpeta"})]})]})})]})};export{z as default};
