import{j as e,ac as s,y as a,af as r,l as t,ag as n,ad as l}from"./ui-BChFafQN.js";import{r as i}from"./vendor-fM8kc8IR.js";import{u as d}from"./useQuery-BWIQYHUH.js";import{d as c,u as o,I as m,B as x,T as u}from"./index-CVZ54knL.js";import{u as j}from"./useMutation-B2sarHY-.js";import{D as h}from"./DashboardLayout-C2CvQ_Yq.js";import{C as p}from"./Card-BeU1eMaR.js";import{B as v}from"./Badge-CFDGoBCM.js";import{M as N}from"./Modal-i9STTiHO.js";import{k as g,l as y,r as f,m as b}from"./api-Cz4wYYaF.js";import{f as w,a as E}from"./helpers-7IRBxzvX.js";import"./constants-A1-OgdCM.js";const C=()=>{const[C,D]=i.useState(""),[I,R]=i.useState(""),[S,L]=i.useState(null),[k,F]=i.useState(""),[M,q]=i.useState(!1),z=c(),B=o(),{data:T,isLoading:A}=d({queryKey:["messages",{search:C,estado:I}],queryFn:()=>b({search:C,estado:I||void 0})}),K=j({mutationFn:({id:e,respuesta:s})=>f(e,s),onSuccess:()=>{B.success("Respuesta enviada correctamente"),z.invalidateQueries({queryKey:["messages"]}),q(!1),F(""),L(null)},onError:()=>{B.error("Error al enviar respuesta")}}),Q=j({mutationFn:y,onSuccess:()=>{B.success("Mensaje eliminado"),z.invalidateQueries({queryKey:["messages"]}),L(null)},onError:()=>{B.error("Error al eliminar mensaje")}}),P=(null==T?void 0:T.data)||[],O=(null==T?void 0:T.unread)||0;return e.jsxs(h,{title:"Mensajes",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4 mb-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(v,{variant:"info",size:"lg",children:[O," sin leer"]}),e.jsxs(v,{variant:"default",size:"lg",children:[(null==T?void 0:T.total)||0," total"]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(m,{placeholder:"Buscar mensajes...",value:C,onChange:e=>D(e.target.value),leftIcon:e.jsx(s,{className:"w-5 h-5"}),className:"w-64"}),e.jsxs("select",{value:I,onChange:e=>R(e.target.value),className:"px-4 py-2 border border-secondary-300 rounded-lg focus:ring-2 focus:ring-primary-500",children:[e.jsx("option",{value:"",children:"Todos"}),e.jsx("option",{value:"Nuevo",children:"Nuevos"}),e.jsx("option",{value:"Leido",children:"LeÃ­dos"}),e.jsx("option",{value:"Respondido",children:"Respondidos"}),e.jsx("option",{value:"Archivado",children:"Archivados"})]})]})]}),e.jsxs("div",{className:"grid lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-1",children:e.jsx(p,{padding:"none",className:"divide-y divide-secondary-100",children:A?e.jsx("div",{className:"p-8 text-center text-secondary-500",children:"Cargando mensajes..."}):0===P.length?e.jsx("div",{className:"p-8 text-center text-secondary-500",children:"No hay mensajes"}):P.map(s=>e.jsx("button",{onClick:()=>(async e=>{L(e),"Nuevo"===e.Estado&&(await g(e.ID,"Leido"),z.invalidateQueries({queryKey:["messages"]}))})(s),className:"w-full p-4 text-left hover:bg-secondary-50 transition-colors "+((null==S?void 0:S.ID)===s.ID?"bg-primary-50":""),children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center "+("Nuevo"===s.Estado?"bg-blue-100 text-blue-600":"bg-secondary-100 text-secondary-600"),children:"Nuevo"===s.Estado?e.jsx(a,{className:"w-5 h-5"}):e.jsx(r,{className:"w-5 h-5"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"font-medium truncate "+("Nuevo"===s.Estado?"text-secondary-900":"text-secondary-700"),children:s.Nombre}),e.jsx(t,{className:"w-4 h-4 text-secondary-400"})]}),e.jsx("p",{className:"text-sm text-secondary-600 truncate",children:s.Asunto||"Sin asunto"}),e.jsx("p",{className:"text-xs text-secondary-400 mt-1",children:w(s.Fecha)})]})]})},s.ID))})}),e.jsx("div",{className:"lg:col-span-2",children:S?e.jsxs(p,{children:[e.jsxs("div",{className:"flex items-start justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-secondary-900",children:S.Asunto||"Sin asunto"}),e.jsxs("p",{className:"text-secondary-600",children:["De: ",S.Nombre]}),e.jsxs("p",{className:"text-sm text-secondary-500",children:[S.Email," | ",S.Telefono]}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsx(v,{className:E(S.Estado),children:S.Estado}),e.jsx("span",{className:"text-xs text-secondary-400",children:w(S.Fecha)})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(x,{variant:"primary",size:"sm",leftIcon:e.jsx(n,{className:"w-4 h-4"}),onClick:()=>q(!0),children:"Responder"}),e.jsx(x,{variant:"danger",size:"sm",leftIcon:e.jsx(l,{className:"w-4 h-4"}),onClick:()=>Q.mutate(S.ID),isLoading:Q.isPending})]})]}),e.jsx("div",{className:"prose max-w-none",children:e.jsx("div",{className:"p-4 bg-secondary-50 rounded-lg",children:e.jsx("p",{className:"text-secondary-700 whitespace-pre-wrap",children:S.Mensaje})})}),S.Respuesta&&e.jsxs("div",{className:"mt-6 pt-6 border-t",children:[e.jsx("h3",{className:"font-semibold text-secondary-900 mb-2",children:"Tu respuesta:"}),e.jsxs("div",{className:"p-4 bg-green-50 rounded-lg border-l-4 border-green-500",children:[e.jsx("p",{className:"text-secondary-700 whitespace-pre-wrap",children:S.Respuesta}),e.jsxs("p",{className:"text-xs text-secondary-500 mt-2",children:["Enviada: ",w(S.FechaRespuesta)]})]})]})]}):e.jsx(p,{className:"flex items-center justify-center h-64",children:e.jsxs("div",{className:"text-center text-secondary-500",children:[e.jsx(a,{className:"w-12 h-12 mx-auto mb-3 opacity-50"}),e.jsx("p",{children:"Selecciona un mensaje para ver los detalles"})]})})})]}),e.jsx(N,{isOpen:M,onClose:()=>q(!1),title:"Responder mensaje",size:"lg",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"p-4 bg-secondary-50 rounded-lg",children:[e.jsxs("p",{className:"text-sm text-secondary-600",children:["Respondiendo a: ",e.jsx("strong",{children:null==S?void 0:S.Nombre})]}),e.jsx("p",{className:"text-sm text-secondary-500",children:null==S?void 0:S.Email})]}),e.jsx(u,{label:"Tu respuesta",placeholder:"Escribe tu respuesta...",rows:6,value:k,onChange:e=>F(e.target.value)}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx(x,{variant:"ghost",onClick:()=>q(!1),children:"Cancelar"}),e.jsx(x,{variant:"primary",onClick:()=>{S&&k.trim()&&K.mutate({id:S.ID,respuesta:k})},isLoading:K.isPending,disabled:!k.trim(),children:"Enviar Respuesta"})]})]})})]})};export{C as default};
