import{j as e,a3 as s,an as a,U as r,o as i,a9 as t,ao as o,u as l,ap as n,aq as c,ar as d,ad as m,ac as u,m as x,E as p,as as h}from"./ui-CW4SeC5O.js";import{r as j}from"./vendor-fM8kc8IR.js";import{u as v}from"./useQuery-FleDKwgl.js";import{d as N,u as y,B as b,I as g,T as f}from"./index-C9MSdL1c.js";import{u as w}from"./useMutation-CLlNb6S2.js";import{D as q}from"./DashboardLayout-CZopp9XZ.js";import{C}from"./Card-BAQzvENO.js";import{M as E}from"./Modal-BXTy6PvI.js";import{q as I,t as D,s as k,v as S,w as A,x as L,y as Q,z as K,A as P,j as T,B as V,C as F}from"./api-Cz4wYYaF.js";import"./constants-CTD2yw_V.js";const z=()=>{const[z,O]=j.useState(""),[$,U]=j.useState(!1),[B,M]=j.useState(null),[G,R]=j.useState({nombre:"",descripcion:"",lider:""}),[H,J]=j.useState(null),[W,X]=j.useState("volunteers"),[Y,Z]=j.useState(!1),[_,ee]=j.useState(!1),[se,ae]=j.useState(""),[re,ie]=j.useState("EQUIPO"),[te,oe]=j.useState(""),[le,ne]=j.useState(()=>(new Date).toISOString().split("T")[0]),ce=N(),de=y(),{data:me,isLoading:ue}=v({queryKey:["teams"],queryFn:P}),{data:xe}=v({queryKey:["volunteers","active"],queryFn:()=>T({estado:"Activo"})}),{data:pe,isLoading:he}=v({queryKey:["teamVolunteers",null==H?void 0:H.ID,null==H?void 0:H.Nombre],queryFn:()=>V(H.ID,H.Nombre),enabled:!!H}),{data:je,isLoading:ve}=v({queryKey:["tasks",null==H?void 0:H.ID,null==H?void 0:H.Nombre,le],queryFn:()=>F({equipoId:H.ID,equipoNombre:H.Nombre,fecha:le}),enabled:!!H&&"tasks"===W}),Ne=w({mutationFn:Q,onSuccess:()=>{de.success("Equipo creado correctamente"),ce.invalidateQueries({queryKey:["teams"]}),Ie()},onError:()=>{de.error("Error al crear equipo")}}),ye=w({mutationFn:({id:e,data:s})=>K(e,s),onSuccess:()=>{de.success("Equipo actualizado correctamente"),ce.invalidateQueries({queryKey:["teams"]}),Ie()},onError:()=>{de.error("Error al actualizar equipo")}}),be=w({mutationFn:L,onSuccess:()=>{de.success("Equipo eliminado"),ce.invalidateQueries({queryKey:["teams"]})},onError:()=>{de.error("Error al eliminar equipo")}}),ge=w({mutationFn:({volunteerId:e,teamId:s,teamName:a})=>S(e,s,a),onSuccess:()=>{de.success("Voluntario agregado al equipo"),ce.invalidateQueries({queryKey:["teamVolunteers"]}),ce.invalidateQueries({queryKey:["teams"]}),ce.invalidateQueries({queryKey:["volunteers"]}),Z(!1),oe("")},onError:()=>{de.error("Error al agregar voluntario")}}),fe=w({mutationFn:I,onSuccess:()=>{de.success("Voluntario removido del equipo"),ce.invalidateQueries({queryKey:["teamVolunteers"]}),ce.invalidateQueries({queryKey:["teams"]}),ce.invalidateQueries({queryKey:["volunteers"]})},onError:()=>{de.error("Error al remover voluntario")}}),we=w({mutationFn:A,onSuccess:()=>{de.success("Tarea creada"),ce.invalidateQueries({queryKey:["tasks"]}),ee(!1),ae(""),ie("EQUIPO")},onError:()=>{de.error("Error al crear tarea")}}),qe=w({mutationFn:({id:e,completado:s})=>D(e,s),onSuccess:()=>{ce.invalidateQueries({queryKey:["tasks"]})},onError:()=>{de.error("Error al actualizar tarea")}}),Ce=w({mutationFn:k,onSuccess:()=>{de.success("Tarea eliminada"),ce.invalidateQueries({queryKey:["tasks"]})},onError:()=>{de.error("Error al eliminar tarea")}}),Ee=e=>{e?(M(e),R({nombre:e.Nombre,descripcion:e.Descripcion||"",lider:e.Lider||""})):(M(null),R({nombre:"",descripcion:"",lider:""})),U(!0)},Ie=()=>{U(!1),M(null),R({nombre:"",descripcion:"",lider:""})},De=e=>{J(e),X("volunteers")},ke=()=>{J(null),X("volunteers")},Se=()=>{if(!se.trim())return void de.error("El título de la tarea es requerido");const e=(null==pe?void 0:pe.data)||[];let s="Todo el equipo";if("EQUIPO"!==re){const a=e.find(e=>e.ID===re);s=a?`${a.Nombre} ${a.Apellidos||""}`.trim():"Sin asignar"}we.mutate({titulo:se,equipoId:H.ID,equipoNombre:H.Nombre,asignadoA:re,asignadoNombre:s,fecha:le})},Ae=(null==me?void 0:me.data)||[],Le=(null==xe?void 0:xe.data)||[],Qe=(null==pe?void 0:pe.data)||[],Ke=(null==je?void 0:je.data)||[],Pe=Ae.filter(e=>e.Nombre.toLowerCase().includes(z.toLowerCase())),Te=Le.filter(e=>{const s=e.Equipo===(null==H?void 0:H.ID)||e.Equipo===(null==H?void 0:H.Nombre),a=!te||`${e.Nombre} ${e.Apellidos}`.toLowerCase().includes(te.toLowerCase());return!s&&a}),Ve=e=>{const s=["from-blue-500 to-blue-600","from-purple-500 to-purple-600","from-green-500 to-green-600","from-amber-500 to-amber-600","from-red-500 to-red-600","from-cyan-500 to-cyan-600"];return s[e%s.length]};if(H){const x=Ae.findIndex(e=>e.ID===H.ID),p=Ve(x>=0?x:0);return e.jsxs(q,{title:"Equipos",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx(b,{variant:"ghost",leftIcon:e.jsx(s,{className:"w-5 h-5"}),onClick:ke,className:"mb-4",children:"Volver a equipos"}),e.jsx("div",{className:`bg-gradient-to-r ${p} rounded-xl p-6 text-white`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:H.Nombre}),H.Descripcion&&e.jsx("p",{className:"text-white/80 mt-1",children:H.Descripcion}),H.Lider&&e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsx(a,{className:"w-4 h-4"}),e.jsxs("span",{children:["Líder: ",H.Lider]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-3xl font-bold",children:Qe.length}),e.jsx("div",{className:"text-white/80 text-sm",children:"miembros"})]})]})})]}),e.jsxs("div",{className:"flex gap-1 mb-6 border-b border-secondary-200",children:[e.jsxs("button",{className:"px-4 py-3 font-medium text-sm flex items-center gap-2 border-b-2 transition-colors "+("volunteers"===W?"border-primary-600 text-primary-600":"border-transparent text-secondary-500 hover:text-secondary-700"),onClick:()=>X("volunteers"),children:[e.jsx(r,{className:"w-4 h-4"}),"Voluntarios"]}),e.jsxs("button",{className:"px-4 py-3 font-medium text-sm flex items-center gap-2 border-b-2 transition-colors "+("tasks"===W?"border-primary-600 text-primary-600":"border-transparent text-secondary-500 hover:text-secondary-700"),onClick:()=>X("tasks"),children:[e.jsx(i,{className:"w-4 h-4"}),"Tareas del Día"]})]}),"volunteers"===W&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-secondary-900",children:"Voluntarios del equipo"}),e.jsx(b,{variant:"primary",size:"sm",leftIcon:e.jsx(t,{className:"w-4 h-4"}),onClick:()=>Z(!0),children:"Agregar Voluntario"})]}),he?e.jsx("div",{className:"text-center py-8 text-secondary-500",children:"Cargando voluntarios..."}):0===Qe.length?e.jsxs(C,{className:"text-center py-8",children:[e.jsx(r,{className:"w-12 h-12 mx-auto text-secondary-300 mb-3"}),e.jsx("p",{className:"text-secondary-500 mb-4",children:"No hay voluntarios asignados a este equipo"}),e.jsx(b,{variant:"primary",size:"sm",leftIcon:e.jsx(t,{className:"w-4 h-4"}),onClick:()=>Z(!0),children:"Agregar Primer Voluntario"})]}):e.jsx("div",{className:"grid gap-3",children:Qe.map(s=>e.jsxs(C,{className:"flex items-center justify-between p-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-primary-100 flex items-center justify-center",children:e.jsx("span",{className:"text-primary-600 font-semibold",children:s.Nombre.charAt(0)})}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium text-secondary-900",children:[s.Nombre," ",s.Apellidos]}),e.jsxs("p",{className:"text-sm text-secondary-500",children:[s.Telefono," • ",s.Area||"Sin área"]})]})]}),e.jsx(b,{variant:"ghost",size:"sm",className:"text-red-600 hover:bg-red-50",onClick:()=>{confirm(`¿Remover a ${s.Nombre} del equipo?`)&&fe.mutate(s.ID)},children:e.jsx(o,{className:"w-4 h-4"})})]},s.ID))})]}),"tasks"===W&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(l,{className:"w-5 h-5 text-secondary-500"}),e.jsx("input",{type:"date",value:le,onChange:e=>ne(e.target.value),className:"px-3 py-2 border border-secondary-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500"})]}),e.jsx(b,{variant:"primary",size:"sm",leftIcon:e.jsx(n,{className:"w-4 h-4"}),onClick:()=>ee(!0),children:"Nueva Tarea"})]}),ve?e.jsx("div",{className:"text-center py-8 text-secondary-500",children:"Cargando tareas..."}):0===Ke.length?e.jsxs(C,{className:"text-center py-8",children:[e.jsx(i,{className:"w-12 h-12 mx-auto text-secondary-300 mb-3"}),e.jsx("p",{className:"text-secondary-500 mb-4",children:"No hay tareas para esta fecha"}),e.jsx(b,{variant:"primary",size:"sm",leftIcon:e.jsx(n,{className:"w-4 h-4"}),onClick:()=>ee(!0),children:"Crear Primera Tarea"})]}):e.jsx("div",{className:"space-y-2",children:Ke.map(s=>e.jsxs(C,{className:"flex items-center justify-between p-4 "+(s.Completado?"bg-green-50 border-green-200":""),children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[e.jsx("button",{onClick:()=>qe.mutate({id:s.ID,completado:!s.Completado}),className:"text-secondary-400 hover:text-primary-600 transition-colors",children:s.Completado?e.jsx(c,{className:"w-6 h-6 text-green-600"}):e.jsx(d,{className:"w-6 h-6"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium "+(s.Completado?"line-through text-secondary-400":"text-secondary-900"),children:s.Titulo}),e.jsxs("p",{className:"text-sm text-secondary-500",children:["Asignado a: ",s.AsignadoNombre||("EQUIPO"===s.AsignadoA?"Todo el equipo":"Sin asignar")]})]})]}),e.jsx(b,{variant:"ghost",size:"sm",className:"text-red-600 hover:bg-red-50",onClick:()=>{confirm("¿Eliminar esta tarea?")&&Ce.mutate(s.ID)},children:e.jsx(m,{className:"w-4 h-4"})})]},s.ID))})]}),e.jsx(E,{isOpen:Y,onClose:()=>{Z(!1),oe("")},title:"Agregar Voluntario al Equipo",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx(g,{placeholder:"Buscar voluntario...",value:te,onChange:e=>oe(e.target.value),leftIcon:e.jsx(u,{className:"w-5 h-5"})}),e.jsx("div",{className:"max-h-64 overflow-y-auto space-y-2",children:0===Te.length?e.jsx("p",{className:"text-center text-secondary-500 py-4",children:"No hay voluntarios disponibles"}):Te.map(s=>e.jsxs("button",{onClick:()=>ge.mutate({volunteerId:s.ID,teamId:H.ID,teamName:H.Nombre}),className:"w-full flex items-center gap-3 p-3 rounded-lg hover:bg-secondary-50 transition-colors text-left",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-primary-100 flex items-center justify-center",children:e.jsx("span",{className:"text-primary-600 font-semibold",children:s.Nombre.charAt(0)})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("p",{className:"font-medium text-secondary-900",children:[s.Nombre," ",s.Apellidos]}),e.jsxs("p",{className:"text-sm text-secondary-500",children:[s.Area||"Sin área"," • ",s.Disponibilidad||"Sin disponibilidad"]})]}),e.jsx(t,{className:"w-5 h-5 text-primary-600"})]},s.ID))})]})}),e.jsx(E,{isOpen:_,onClose:()=>{ee(!1),ae(""),ie("EQUIPO")},title:"Nueva Tarea",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx(g,{label:"Título de la tarea",placeholder:"Ej: Llamar a coordinadores",value:se,onChange:e=>ae(e.target.value),required:!0}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-secondary-700 mb-2",children:"Asignar a"}),e.jsxs("select",{value:re,onChange:e=>ie(e.target.value),className:"w-full px-4 py-2 border border-secondary-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500",children:[e.jsx("option",{value:"EQUIPO",children:"Todo el equipo"}),Qe.map(s=>e.jsxs("option",{value:s.ID,children:[s.Nombre," ",s.Apellidos]},s.ID))]})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[e.jsx(b,{variant:"ghost",onClick:()=>{ee(!1),ae(""),ie("EQUIPO")},children:"Cancelar"}),e.jsx(b,{variant:"primary",onClick:Se,isLoading:we.isPending,children:"Crear Tarea"})]})]})})]})}return e.jsxs(q,{title:"Equipos",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4 mb-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-primary-100 rounded-lg flex items-center justify-center",children:e.jsx(r,{className:"w-6 h-6 text-primary-600"})}),e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-bold text-secondary-900",children:[Ae.length," Equipos"]}),e.jsx("p",{className:"text-sm text-secondary-500",children:"Gestiona los equipos de campaña"})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(g,{placeholder:"Buscar equipos...",value:z,onChange:e=>O(e.target.value),leftIcon:e.jsx(u,{className:"w-5 h-5"}),className:"w-48"}),e.jsx(b,{variant:"primary",leftIcon:e.jsx(n,{className:"w-4 h-4"}),onClick:()=>Ee(),children:"Nuevo Equipo"})]})]}),ue?e.jsx("div",{className:"text-center py-12 text-secondary-500",children:"Cargando equipos..."}):0===Pe.length?e.jsxs(C,{className:"text-center py-12",children:[e.jsx(r,{className:"w-16 h-16 mx-auto text-secondary-300 mb-4"}),e.jsx("p",{className:"text-secondary-500",children:"No hay equipos registrados"}),e.jsx(b,{variant:"primary",className:"mt-4",leftIcon:e.jsx(n,{className:"w-4 h-4"}),onClick:()=>Ee(),children:"Crear Primer Equipo"})]}):e.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-6",children:Pe.map((s,r)=>e.jsx(x.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1*r},children:e.jsxs(C,{className:"overflow-hidden hover:shadow-lg transition-shadow",children:[e.jsx("div",{className:`bg-gradient-to-r ${Ve(r)} -mx-6 -mt-6 px-6 py-4 mb-4`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-bold text-white",children:s.Nombre}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:()=>De(s),className:"p-2 text-white/80 hover:text-white hover:bg-white/20 rounded-lg transition-colors",title:"Ver equipo",children:e.jsx(p,{className:"w-4 h-4"})}),e.jsx("button",{onClick:e=>{e.stopPropagation(),Ee(s)},className:"p-2 text-white/80 hover:text-white hover:bg-white/20 rounded-lg transition-colors",title:"Editar",children:e.jsx(h,{className:"w-4 h-4"})}),e.jsx("button",{onClick:e=>{e.stopPropagation(),confirm("¿Estás seguro de eliminar este equipo?")&&be.mutate(s.ID)},className:"p-2 text-white/80 hover:text-white hover:bg-white/20 rounded-lg transition-colors",title:"Eliminar",children:e.jsx(m,{className:"w-4 h-4"})})]})]})}),e.jsxs("div",{className:"cursor-pointer",onClick:()=>De(s),children:[s.Descripcion&&e.jsx("p",{className:"text-secondary-600 text-sm mb-4",children:s.Descripcion}),s.Lider&&e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-secondary-50 rounded-lg mb-4",children:[e.jsx(a,{className:"w-5 h-5 text-amber-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-secondary-500",children:"Líder"}),e.jsx("p",{className:"font-medium text-secondary-900",children:s.Lider})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2 text-secondary-600",children:[e.jsx(t,{className:"w-4 h-4"}),e.jsxs("span",{className:"text-sm",children:[s.Miembros||0," miembros"]})]}),e.jsx("span",{className:"text-sm text-primary-600 font-medium",children:"Ver detalles →"})]})]})]})},s.ID))}),e.jsx(E,{isOpen:$,onClose:Ie,title:B?"Editar Equipo":"Nuevo Equipo",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx(g,{label:"Nombre del equipo",placeholder:"Ej: Redes Sociales",value:G.nombre,onChange:e=>R({...G,nombre:e.target.value}),required:!0}),e.jsx(f,{label:"Descripción",placeholder:"Describe las funciones de este equipo...",value:G.descripcion,onChange:e=>R({...G,descripcion:e.target.value}),rows:3}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-secondary-700 mb-2",children:"Líder del equipo"}),e.jsxs("select",{value:G.lider,onChange:e=>R({...G,lider:e.target.value}),className:"w-full px-4 py-2 border border-secondary-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500",children:[e.jsx("option",{value:"",children:"Seleccionar líder..."}),Le.map(s=>e.jsxs("option",{value:`${s.Nombre} ${s.Apellidos}`,children:[s.Nombre," ",s.Apellidos]},s.ID))]})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[e.jsx(b,{variant:"ghost",onClick:Ie,children:"Cancelar"}),e.jsx(b,{variant:"primary",onClick:()=>{G.nombre.trim()?B?ye.mutate({id:B.ID,data:{Nombre:G.nombre,Descripcion:G.descripcion,Lider:G.lider}}):Ne.mutate({nombre:G.nombre,descripcion:G.descripcion,lider:G.lider}):de.error("El nombre es requerido")},isLoading:Ne.isPending||ye.isPending,children:B?"Guardar Cambios":"Crear Equipo"})]})]})})]})};export{z as default};
