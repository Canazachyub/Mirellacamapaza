import{j as e,U as s,u as a,b as t,ac as r,D as l,m as i,M as c,E as n,p as d,a as o,ad as x,y as m,x as h}from"./ui-BChFafQN.js";import{r as j}from"./vendor-fM8kc8IR.js";import{u as p}from"./useQuery-BWIQYHUH.js";import{d as f,u as N,I as u,B as g}from"./index-CVZ54knL.js";import{u as y}from"./useMutation-B2sarHY-.js";import{D as b}from"./DashboardLayout-C2CvQ_Yq.js";import{C as v}from"./Card-BeU1eMaR.js";import{B as w}from"./Badge-CFDGoBCM.js";import{M as D}from"./Modal-i9STTiHO.js";import{e as E,u as F,f as C}from"./api-Cz4wYYaF.js";import{a as I,f as P}from"./helpers-7IRBxzvX.js";import{g as z}from"./generateAffiliatePDF-CgKJHnn7.js";import"./constants-A1-OgdCM.js";const S=()=>{const[S,k]=j.useState(""),[A,R]=j.useState(""),[T,V]=j.useState(null),[B,L]=j.useState(!1),O=f(),U=N(),{data:q,isLoading:M}=p({queryKey:["affiliates",{search:S,estado:A}],queryFn:()=>C({search:S,estado:A||void 0})}),K=y({mutationFn:({id:e,estado:s})=>F(e,{Estado:s}),onSuccess:()=>{U.success("Estado actualizado correctamente"),O.invalidateQueries({queryKey:["affiliates"]})},onError:()=>{U.error("Error al actualizar estado")}}),Q=y({mutationFn:E,onSuccess:()=>{U.success("Afiliado eliminado"),O.invalidateQueries({queryKey:["affiliates"]}),L(!1)},onError:()=>{U.error("Error al eliminar afiliado")}}),$=(e,s)=>{K.mutate({id:e,estado:s})},_=e=>{try{z(e),U.success("Ficha PDF generada correctamente")}catch(s){console.error("Error generating PDF:",s),U.error("Error al generar el PDF")}},G=(null==q?void 0:q.data)||[],H={total:(null==q?void 0:q.total)||0,pending:(null==q?void 0:q.pending)||0,verified:(null==q?void 0:q.verified)||0};return e.jsxs(b,{title:"Afiliados",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[e.jsx(v,{className:"bg-gradient-to-r from-blue-500 to-blue-600 text-white",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-white/20 rounded-lg flex items-center justify-center",children:e.jsx(s,{className:"w-6 h-6"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-blue-100",children:"Total Afiliados"}),e.jsx("p",{className:"text-3xl font-bold",children:H.total})]})]})}),e.jsx(v,{className:"bg-gradient-to-r from-amber-500 to-amber-600 text-white",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-white/20 rounded-lg flex items-center justify-center",children:e.jsx(a,{className:"w-6 h-6"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-amber-100",children:"Pendientes"}),e.jsx("p",{className:"text-3xl font-bold",children:H.pending})]})]})}),e.jsx(v,{className:"bg-gradient-to-r from-green-500 to-green-600 text-white",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-white/20 rounded-lg flex items-center justify-center",children:e.jsx(t,{className:"w-6 h-6"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-green-100",children:"Verificados"}),e.jsx("p",{className:"text-3xl font-bold",children:H.verified})]})]})})]}),e.jsx(v,{className:"mb-6",children:e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex gap-3",children:[e.jsx(u,{placeholder:"Buscar afiliados...",value:S,onChange:e=>k(e.target.value),leftIcon:e.jsx(r,{className:"w-5 h-5"}),className:"w-64"}),e.jsxs("select",{value:A,onChange:e=>R(e.target.value),className:"px-4 py-2 border border-secondary-300 rounded-lg focus:ring-2 focus:ring-primary-500",children:[e.jsx("option",{value:"",children:"Todos los estados"}),e.jsx("option",{value:"Pendiente",children:"Pendiente"}),e.jsx("option",{value:"Verificado",children:"Verificado"}),e.jsx("option",{value:"Rechazado",children:"Rechazado"})]})]}),e.jsx(g,{variant:"outline",leftIcon:e.jsx(l,{className:"w-4 h-4"}),onClick:()=>{const e=(null==q?void 0:q.data)||[];if(0===e.length)return void U.error("No hay datos para exportar");const s=e.map(e=>[e.Nombre,e.DNI,e.Email,e.Telefono,e.Provincia,e.Distrito,e.Estado,new Date(e.Fecha).toLocaleDateString()]),a=[["Nombre","DNI","Email","Teléfono","Provincia","Distrito","Estado","Fecha"].join(","),...s.map(e=>e.join(","))].join("\n"),t=new Blob([a],{type:"text/csv;charset=utf-8;"}),r=document.createElement("a");r.href=URL.createObjectURL(t),r.download=`afiliados_${(new Date).toISOString().split("T")[0]}.csv`,r.click(),U.success("Archivo exportado correctamente")},children:"Exportar CSV"})]})}),e.jsx(v,{padding:"none",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-secondary-50 border-b border-secondary-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left py-4 px-6 font-semibold text-secondary-700",children:"Nombre"}),e.jsx("th",{className:"text-left py-4 px-6 font-semibold text-secondary-700",children:"DNI"}),e.jsx("th",{className:"text-left py-4 px-6 font-semibold text-secondary-700",children:"Contacto"}),e.jsx("th",{className:"text-left py-4 px-6 font-semibold text-secondary-700",children:"Ubicación"}),e.jsx("th",{className:"text-left py-4 px-6 font-semibold text-secondary-700",children:"Estado"}),e.jsx("th",{className:"text-left py-4 px-6 font-semibold text-secondary-700",children:"Fecha"}),e.jsx("th",{className:"text-center py-4 px-6 font-semibold text-secondary-700",children:"Acciones"})]})}),e.jsx("tbody",{className:"divide-y divide-secondary-100",children:M?e.jsx("tr",{children:e.jsx("td",{colSpan:7,className:"py-8 text-center text-secondary-500",children:"Cargando afiliados..."})}):0===G.length?e.jsx("tr",{children:e.jsx("td",{colSpan:7,className:"py-8 text-center text-secondary-500",children:"No hay afiliados registrados"})}):G.map(s=>e.jsxs(i.tr,{initial:{opacity:0},animate:{opacity:1},className:"hover:bg-secondary-50 transition-colors",children:[e.jsx("td",{className:"py-4 px-6",children:e.jsx("div",{className:"font-medium text-secondary-900",children:s.Nombre})}),e.jsx("td",{className:"py-4 px-6 text-secondary-600",children:s.DNI}),e.jsx("td",{className:"py-4 px-6",children:e.jsxs("div",{className:"flex flex-col text-sm",children:[e.jsx("span",{className:"text-secondary-600",children:s.Email}),e.jsx("span",{className:"text-secondary-500",children:s.Telefono})]})}),e.jsx("td",{className:"py-4 px-6",children:e.jsxs("div",{className:"flex items-center gap-1 text-sm text-secondary-600",children:[e.jsx(c,{className:"w-4 h-4"}),s.Distrito,", ",s.Provincia]})}),e.jsx("td",{className:"py-4 px-6",children:e.jsx(w,{className:I(s.Estado),children:s.Estado})}),e.jsx("td",{className:"py-4 px-6 text-sm text-secondary-500",children:P(s.Fecha)}),e.jsx("td",{className:"py-4 px-6",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("button",{onClick:()=>(e=>{V(e),L(!0)})(s),className:"p-2 text-secondary-600 hover:text-primary-600 hover:bg-primary-50 rounded-lg transition-colors",title:"Ver detalles",children:e.jsx(n,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>_(s),className:"p-2 text-blue-600 hover:bg-blue-50 rounded-lg transition-colors",title:"Descargar Ficha PDF",children:e.jsx(d,{className:"w-4 h-4"})}),"Pendiente"===s.Estado&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>$(s.ID,"Verificado"),className:"p-2 text-green-600 hover:bg-green-50 rounded-lg transition-colors",title:"Aprobar",children:e.jsx(t,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>$(s.ID,"Rechazado"),className:"p-2 text-red-600 hover:bg-red-50 rounded-lg transition-colors",title:"Rechazar",children:e.jsx(o,{className:"w-4 h-4"})})]}),e.jsx("button",{onClick:()=>Q.mutate(s.ID),className:"p-2 text-red-600 hover:bg-red-50 rounded-lg transition-colors",title:"Eliminar",children:e.jsx(x,{className:"w-4 h-4"})})]})})]},s.ID))})]})})}),e.jsx(D,{isOpen:B,onClose:()=>L(!1),title:"Detalles del Afiliado",size:"lg",children:T&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-16 h-16 bg-primary-100 rounded-full flex items-center justify-center",children:e.jsx(s,{className:"w-8 h-8 text-primary-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-secondary-900",children:T.Nombre}),e.jsxs("p",{className:"text-secondary-600",children:["DNI: ",T.DNI]})]})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"p-4 bg-secondary-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 text-secondary-600 mb-1",children:[e.jsx(m,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm",children:"Email"})]}),e.jsx("p",{className:"font-medium",children:T.Email})]}),e.jsxs("div",{className:"p-4 bg-secondary-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 text-secondary-600 mb-1",children:[e.jsx(h,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm",children:"Teléfono"})]}),e.jsx("p",{className:"font-medium",children:T.Telefono})]}),e.jsxs("div",{className:"p-4 bg-secondary-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 text-secondary-600 mb-1",children:[e.jsx(c,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm",children:"Ubicación"})]}),e.jsxs("p",{className:"font-medium",children:[T.Distrito,", ",T.Provincia]})]}),e.jsxs("div",{className:"p-4 bg-secondary-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 text-secondary-600 mb-1",children:[e.jsx(a,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm",children:"Fecha de registro"})]}),e.jsx("p",{className:"font-medium",children:new Date(T.Fecha).toLocaleDateString("es-PE",{year:"numeric",month:"long",day:"numeric"})})]})]}),T.Ocupacion&&e.jsxs("div",{className:"p-4 bg-secondary-50 rounded-lg",children:[e.jsx("p",{className:"text-sm text-secondary-600 mb-1",children:"Ocupación"}),e.jsx("p",{className:"font-medium",children:T.Ocupacion})]}),e.jsx("div",{className:"p-4 bg-blue-50 border border-blue-200 rounded-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-blue-900",children:"Ficha de Afiliación PDF"}),e.jsx("p",{className:"text-sm text-blue-700",children:"Descarga la ficha para agregar foto, firma y huella digital"})]}),e.jsx(g,{variant:"primary",leftIcon:e.jsx(d,{className:"w-4 h-4"}),onClick:()=>_(T),children:"Descargar PDF"})]})}),e.jsxs("div",{className:"flex items-center justify-between pt-4 border-t",children:[e.jsx(w,{size:"lg",className:I(T.Estado),children:T.Estado}),e.jsxs("div",{className:"flex gap-2",children:["Pendiente"===T.Estado&&e.jsxs(e.Fragment,{children:[e.jsx(g,{variant:"success",size:"sm",leftIcon:e.jsx(t,{className:"w-4 h-4"}),onClick:()=>{$(T.ID,"Verificado"),L(!1)},children:"Aprobar"}),e.jsx(g,{variant:"danger",size:"sm",leftIcon:e.jsx(o,{className:"w-4 h-4"}),onClick:()=>{$(T.ID,"Rechazado"),L(!1)},children:"Rechazar"})]}),e.jsx(g,{variant:"ghost",size:"sm",onClick:()=>L(!1),children:"Cerrar"})]})]})]})})]})};export{S as default};
